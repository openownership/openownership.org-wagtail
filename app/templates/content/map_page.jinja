{% extends 'base_with_menu.jinja' %}


{% block content %}


    <div class="intro">
        {{ page.intro|richtext }}
    </div>

    {# Stripes for use in CSS for filling a shape.
       From https://stackoverflow.com/a/22643745/250962
       In CSS set the `fill` color for .map-hatch-bg and the
       `stroke` color for .map-hatch-fg.
       Then apply the stripe background to an eelement with:
        fill: url(#diagonalHatch) #f00;
        with the color being a fallback.
    #}
    <svg>
        <pattern id="diagonalHatch" width="5" height="5" patternTransform="rotate(45 0 0)" patternUnits="userSpaceOnUse">
            <rect class="map-hatch-bg" x="0" y="0" width="5" height="5" />
            <line class="map-hatch-fg" x1="0" y1="0" x2="0" y2="5" style="stroke-width:5" />
        </pattern>
    </svg>

    <p>[NOTE: Country boundaries are currently from https://geojson-maps.ash.ms ]</p>

    <div class="js-map map"></div>

    <section class="grid-cols grid--2-col">
        <div class="country__header-card">
            <a href="" class="country__header-card_header js-map-committed">{% trans %}Commitment to BOT{% endtrans %}</a><br>
            <span class="country__header-card_row">{% trans %}Central Register{% endtrans %} ({{ country_counts.committed_central }})</span><br>
            <span class="country__header-card_row">{% trans %}Public Register{% endtrans %} ({{ country_counts.committed_public }})</span>
        </div>

        <div class="country__header-card">
            <a href="#" class="country__header-card_header js-map-implementation">{% trans %}Implementation of BOT{% endtrans %}</a><br>
            <span class="country__header-card_row">{% trans %}Central Register{% endtrans %} ({{ country_counts.implementation_central }})</span><br>
            <span class="country__header-card_row">{% trans %}Public Register{% endtrans %} ({{ country_counts.implementation_public }})</span>
        </div>

        <div class="country__header-col">
            Regions where Open Ownership is engaged
        </div>
        <div class="country__header-col">
            <a href="#" class="button">{% trans %}Download all country data{% endtrans %}</a>
        </div>
    </section>

    <hr/>

    {# 
    <section>
        <h2>{% trans %}Find a specific country{% endtrans %}</h2>
        <p>{% trans %}Find country activity through the map, search or from the regions listed below{% endtrans %}</p>
        <form action="/search/" method="GET" class="country-search__form">
            <div class="relative max-w-sixcol">
                <label for="q" class="sr-only">Search</label>
                <input type="text" id="q" name="q" value="{{search_query or ''}}" placeholder="Country search">
                <button type="submit" class="btn">Search</button>
            </div>
        </form>

        <div class="accordion">
            {% for region in regions %}
                <button class="accordion__button region__button">
                    {{region.name}}
                </button>
                {% for country in region.countries.all() %}
                    <div id="accordion-section-{{region.slug}}" class="accordion__section open">
                        <a href="{{ country.url }}">{{ country.name }}</a>
                    </div>
                {% endfor %}
            {% endfor %}
        </div>
    </section>
    #}

{% endblock content %}

{% block js_prepend %}
    <script src="https://cdn.jsdelivr.net/npm/d3@7"></script>

    <script type="text/javascript">
        {# countries.json from https://geojson-maps.ash.ms #}
        var geojsonPath = "{{static('data/countries.json')}}";
        var mapData = {{ map_json|safe }};
    </script>
{% endblock %}
