{#
A list of pages in a menu at the side of a page.

Expects:

* menu_pages - A nested list. Each item will have:
    * page - A Page object
    * children - If this is the page we're on, and the Page has children, this will contain a PageQueryset of the child Pages. Otherwise it's an empty list.

* page - The current Page

* title - optional, the title for the menu. If falsey, the section page's title will be used.
#}

{% if menu_pages %}
    {% if title %}
        <h2>{{ title }}</h2>
    {% else %}

        {% with section_page=page.section_page %}
            {% if section_page %}
                <h2>{{ section_page.title }}</h2>
            {% endif %}
        {% endwith %}
    {% endif %}
    <ul>
        {% for p in menu_pages %}
            <li class="{% if p.page.pk == page.pk %}current{% endif %}{% if p.children %}is-open{% endif %}">
                {% if p.page.pk == page.pk %}
                    {{ p.page.title }}
                {% else %}
                    <a href="{{ p.page.url }}">{{ p.page.title }}</a>
                {% endif %}

                {% if p.children %}
                    <ul>
                        {% for child in p.children %}
                            <li class="{% if child.pk == page.pk %}current{% endif %}">
                                {% if child.pk == page.pk %}
                                    {{ child.title }}
                                {% else %}
                                    <a href="{{ child.url }}">{{ child.title }}</a>
                                {% endif %}
                            </li>
                        {% endfor %}
                    </ul>
                {% endif %}
            </li>
        {% endfor %}
    </ul>
{% endif %}
