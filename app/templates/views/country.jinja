{% set body_classes = "country-page" %}
{% extends 'base_with_menu.jinja' %}


{% block crumbs %}
    <div class="contained-width {{ main_classes }}">

        {% with breadcrumb_page=page.breadcrumb_page %}
            {% if breadcrumb_page %}
                <div class="breadcrumbs">
                    <a class="reverse-underline" href="{{ breadcrumb_page.get_url() }}"><span aria-hidden="true"> < </span>{% trans %}Back to{% endtrans %} {{ breadcrumb_page.title }}</a>
                </div>
            {% endif %}
        {% endwith %}

    </div>
{% endblock %}

{% block content %}

<article>
    <div class="country-page__overview">
        {% if country.map_image %}
        <div class="country-page__map">
            {{ picture(country.map_image, 300, 194) }}
        </div>
        {% endif %}

        <div class="country-page__details">
            <p><strong>Records last updated: {{ country.notion_updated|nicedate }}</strong></p>
            
            {% if country.consultant %}
                <p>
                    <strong>
                        {% trans %}Consultant's details:{% endtrans %}
                    </strong>
                    <a href="{{ country.consultant.url }}">
                        {{ country.consultant.title }}
                    </a>
                </p>
            {% endif %}
        </div>
    </div>

    <div class="country-page__country-data">

        <div class="country-page__country-data-box">
            <h2 class="country-page__country-data-box-header">
                {% include "svg/commitment-icon.jinja" %}
                {% trans %}Commitment to BOT{% endtrans %}
            </h2>

            <ul class="country-page__country-data-box-list">
                <li class="country-page__country-data-box-list-item">
                    {% if checkbox(country.committed_central) == 'YES' %}
                        {% include "svg/confirm-icon.jinja" %}
                    {% else %}
                        {% include "svg/not-confirm-icon.jinja" %}
                    {% endif %}
                    
                    {% trans %}Central Register{% endtrans %}
                </li>

                <li  class="country-page__country-data-box-list-item">
                    {% if checkbox(country.committed_public) == 'YES' %}
                        {% include "svg/confirm-icon.jinja" %}
                    {% else %}
                        {% include "svg/not-confirm-icon.jinja" %}
                    {% endif %}
                    {% trans %}Public Register{% endtrans %}
                </li>
            </ul>
        </div>

        <div class="country-page__country-data-box">
            <h2 class="country-page__country-data-box-header">
                {% include "svg/implementation-icon.jinja" %}
                {% trans %}Implementation of BOT{% endtrans %}
            </h2>

            <ul class="country-page__country-data-box-list">
                <li class="country-page__country-data-box-list-item">
                    {% if checkbox(country.implementation_central) == 'YES' %}
                        {% include "svg/confirm-icon.jinja" %}
                    {% else %}
                        {% include "svg/not-confirm-icon.jinja" %}
                    {% endif %}
                    
                    {% trans %}Central register: Open Ownership register{% endtrans %}
                </li>

                <li  class="country-page__country-data-box-list-item">
                    {% if checkbox(country.implementation_public) == 'YES' %}
                        {% include "svg/confirm-icon.jinja" %}
                    {% else %}
                        {% include "svg/not-confirm-icon.jinja" %}
                    {% endif %}
                    {% trans %}Public register: UK PSC Register{% endtrans %}
                </li>
            </ul>
        </div>
    </div>

    <a href="#" class="ghost-link">{% trans %}Download Country Data{% endtrans %}</a>

{# only when "publish" #}

{#
Request to add additional fields from the Disclosure Regimes tracker to the 'Show further detail' dropdown on country profile pages:

Implementation detail title
Title of implementation [field = Title] and link title to URL for Register if [field = 5.1 Public access: Register URL] is filled in

Show further detail dropdown


Building on earlier conversations, we would only like these fields to show up for an implementation example when the field has been filled in on the Notion database. Blank fields should not be shown.

Reminder that we have the Annotated country profile page with links to relevant Notion fields but this image is missing these additional fields. I have updated the spreadsheet of all Notion fields).
#}

    <div class="country-page__content">
        <section class="country-page__section">
            <h2>{% trans %}Commitment Detail{% endtrans %}</h2>

            <ul>
                {% for commitment in country.commitments.all() %}
                <li>
                    {{ commitment_summary(commitment.commitment_type_name, country) }} [{{ commitment.date|nicedate }}]
                    {% if commitment.link %}<a href="{{ commitment.link }}">link to commitment</a>{% endif %}
                </li>
                {% endfor %}
            </ul>
            
        </section>

        <section class="country-page__section">
           
            <h2>{% trans %}Implementation Detail{% endtrans %}</h2>
            {% for regime in country.disclosure_regimes.all() %}
                <p>{{ regime.title }}</p>
            {% endfor %}

            <details>
                <summary>{% trans %}Show further detail{% endtrans %}</summary>
                <div class="implementation-details">
                    <dl>
                        {% if country.implementation_title %}
                        <dt>{% trans %}Title of implementation{% endtrans %}</dt>
                        <dd>
                            {% if country.implementation_title_link %}<a href="{{ country.implementation_title_link }}">{% endif %}
                            {{ country.implementation_title }}
                            {% if country.implementation_title_link %}</a>{% endif %}
                        </dd>
                        {% endif %}

                        <dt>{% trans %}Central register implemented{% endtrans %}</dt>
                        <dd>{{ country.implementation_central|yesno }}</dd>

                        <dt>{% trans %}Public access{% endtrans %}</dt>
                        <dd>{{ country.implementation_public|yesno }}</dd>

                        {% if country.display_scope %}
                        <dt>{% trans %}Scope{% endtrans %}</dt>
                        <dd>{{ country.display_scope }}</dd>
                        {% endif %}

                        {% if country.display_register_launched %}
                        <dt>{% trans %}Register launched{% endtrans %}</dt>
                        <dd>{{ country.display_register_launched }}</dd>
                        {% endif %}

                        {% if country.display_threshold %}
                        <dt>{% trans %}Threshold used to determine beneficial ownership{% endtrans %}</dt>
                        <dd>{{ country.display_threshold }}</dd>
                        {% endif %}

                        <dt>{% trans %}Structured data publicly available{% endtrans %}</dt>
                        <dd>{{ country.display_structured_data|yesno }}</dd>

                        <dt>{% trans %}Available as BODS{% endtrans %}</dt>
                        <dd>{{ country.display_data_in_bods|yesno }}</dd>

                        <dt>{% trans %}Available via API{% endtrans %}</dt>
                        <dd>{{ country.display_api|yesno }}</dd>

                        <dt>{% trans %}Available on the OO register{% endtrans %}</dt>
                        <dd>{{ country.display_oo_register|yesno }}</dd>
                    </dl>
                </div>
            </details>
        </section>

        {# This section will come post-launch #}
        {# <section>
            <hr/>
            <h2>{% trans %}Legislation Detail{% endtrans %}</h2>
        </section> #}
    </div>

</article>


{% set related_pages = country.latest_related(3) %}
{% if related_pages|length %}
<div class="related-pages">
    <h2>{% trans %}Relevant articles and publications{% endtrans %}</h2>
    {% with pages=related_pages, columns=1, card_format='landscape' %}
        {% include "_partials/card_group.jinja" %}
    {% endwith %}
</div>
{% endif %}


{{ super() }}

{% endblock %}
